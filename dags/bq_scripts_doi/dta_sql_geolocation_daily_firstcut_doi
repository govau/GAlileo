/*
BigQuery SQL Script
Script to output geo locations, local cities and international countries that are visiting the agency's websites - first cut
*/

/* Schedule: Manual run - once only for first cut of agencies' dataset */

BEGIN
    
    CREATE OR REPLACE TABLE dta_customers.pageviews_daily_snapshot_local_city_doi
    (
        local_city string,
        geo_y string,
        geo_x string,
        local_city_count INT64 OPTIONS (description = "Local city from where registered domain is visited to date"),
        reg_domain string,
        record_timestamp date,
        posted_timestamp timestamp
    )
    PARTITION BY record_timestamp 
    OPTIONS (
        description = "Local cities count for registered domain in agencies' sector",
        partition_expiration_days = 365,
        require_partition_filter = false
    )
    ;

    insert into dta_customers.pageviews_daily_snapshot_local_city_doi
    select
        local_city,
        geo_y,
        geo_x,
        count(*) as local_city_count,
        net.reg_domain(hostname) as reg_domain,
        cast(current_timestamp as date) as record_timestamp,
        current_timestamp
    from
    (
/* Start - Datasets of agencies' websites
    Insert Here Google Analytics Dataset of Websites of Interest and 'Union All' query result sets to get final result set
 */
           select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `122829809.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `6533313.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `73191096.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `103904192.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `37548566.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `39020822.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `121386494.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `114274207.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `121638199.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `149444086.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `122418128.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `135989789.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `162370350.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `178909235.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `5426088.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `6059849.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `106413345.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `117865571.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `117867575.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `53678167.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `77559172.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `77562775.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `80703744.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `100585217.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `111564569.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `124827135.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `174497994.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `179394289.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `72008433.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `77614012.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `86630641.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `69522323.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `70856817.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `71597546.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `77664740.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `129200625.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `82020118.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `88992271.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `98349897.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `100095166.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `100095673.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `74070468.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `133849100.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `175671120.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `175869519.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `48099294.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `78700159.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `94174429.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `94178846.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `100180008.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `100832347.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `104411629.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `34938005.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `77084214.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `85844330.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `86149663.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `90974611.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `95014024.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `118336527.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `130142010.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `170387771.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `99993137.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `80842702.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `199921542.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `23233927.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `2802109.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `70635257.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `73966990.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `191126238.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `203109603.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `47586269.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `5289745.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `93868316.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.city as local_city,
              geoNetwork.latitude as geo_y,
              geoNetwork.longitude as geo_x
            from
              `94241432.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and geoNetwork.country = "Australia"
             and totals.visits =1
/* End - Datasets of agencies' websites */
    )
    GROUP BY   reg_domain,
                        local_city,
                        geo_y,
                        geo_x
      having count(*) > 99;


/*
Pageviews of agencies' Industry by Country
*/
CREATE OR REPLACE TABLE dta_customers.pageviews_daily_snapshot_country_doi
    (
        country string,
        country_count INT64 OPTIONS (description = "Country from where registered domain is visited to date"),
        reg_domain string,
        record_timestamp date,
        posted_timestamp timestamp
    )
    PARTITION BY record_timestamp 
    OPTIONS (
        description = "Country count for registered domain in agencies' sector",
        partition_expiration_days = 365,
        require_partition_filter = false
    )
    ;

    insert into dta_customers.pageviews_daily_snapshot_country_doi
    select
        country,
        count(*) as country_count,
        net.reg_domain(hostname) as reg_domain,
        cast(current_timestamp as date) as record_timestamp,
        current_timestamp
    from
    (
/* Start - Datasets of agencies' websites
    Insert Here Google Analytics Dataset of Websites of Interest and 'Union All' query result sets to get final result set
 */
          select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `122829809.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `6533313.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `73191096.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `103904192.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `37548566.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `39020822.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `121386494.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `114274207.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `121638199.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `149444086.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `122418128.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `135989789.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `162370350.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `178909235.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `5426088.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `6059849.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `106413345.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `117865571.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `117867575.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `53678167.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `77559172.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `77562775.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `80703744.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `100585217.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `111564569.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `124827135.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `174497994.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `179394289.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `72008433.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `77614012.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `86630641.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `69522323.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `70856817.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `71597546.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `77664740.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `129200625.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `82020118.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `88992271.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `98349897.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `100095166.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `100095673.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `74070468.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `133849100.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `175671120.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `175869519.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `48099294.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `78700159.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `94174429.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `94178846.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `100180008.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `100832347.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `104411629.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `34938005.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `77084214.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `85844330.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `86149663.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `90974611.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `95014024.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `118336527.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `130142010.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `170387771.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `99993137.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `80842702.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `199921542.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `23233927.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `2802109.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `70635257.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `73966990.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `191126238.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `203109603.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `47586269.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `5289745.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `93868316.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1 
            union all
            select
              hits.page.hostname as hostname,
              geoNetwork.country as country
            from
              `94241432.ga_sessions_*` AS GA,
              UNNEST(GA.hits) AS hits
            where hits.type = 'PAGE'
             and regexp_contains(hits.page.hostname, ".*.gov.au$") = true
             and totals.visits =1  
/* End - Datasets of agencies' websites */
    )
    GROUP BY    reg_domain,
                        country
   having count(*) > 99;





END;